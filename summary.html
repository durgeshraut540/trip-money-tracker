<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Summary</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        h1 {
            color: #333;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f4f4f4;
        }
    </style>
</head>
<body>
    <header>
        <h1>Summary Page</h1>
    </header>
    <section>
        <h2>Contributors</h2>
        <table id="contributors-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Amount</th>
                </tr>
            </thead>
            <tbody>
                <!-- Contributors data will be dynamically inserted here -->
            </tbody>
        </table>
    </section>
    <section>
        <h2>Expense Sheet</h2>
        <table id="expenses-table">
            <thead>
                <tr>
                    <th>Expense Name</th>
                    <th>Amount (₹)</th>
                    <th>Paid By</th>
                    <th>Comments</th>
                </tr>
            </thead>
            <tbody>
                <!-- Expenses data will be dynamically inserted here -->
            </tbody>
        </table>
    </section>
    <script>
        const AZURE_STORAGE_ACCOUNT = "durgeshpocstorage";
        const AZURE_CONTAINER_NAME = "tracker";
        const SAS_TOKEN = "sp=racwdl&st=2024-12-28T06:15:39Z&se=2025-03-05T14:15:39Z&sv=2022-11-02&sr=c&sig=3KVwE9SnveqCG37i6kKHN809s2YqbLlSg5UNEhie%2F9c%3D";
        const BLOB_URL = `https://${AZURE_STORAGE_ACCOUNT}.blob.core.windows.net/${AZURE_CONTAINER_NAME}/data.json`;

        // DOM Elements
        const contributorsTableBody = document.querySelector("#contributors-table tbody");
        const expensesTableBody = document.querySelector("#expenses-table tbody");

        // Fetch Data from Azure Blob
        async function fetchData() {
            try {
                const response = await fetch(`${BLOB_URL}?${SAS_TOKEN}`);
                if (!response.ok) throw new Error(`HTTP error: ${response.status}`);
                const data = await response.json();
                return {
                    contributors: data.contributors || [],
                    expenses: data.expenses || [],
                };
            } catch (error) {
                console.error("Error fetching data:", error);
                return { contributors: [], expenses: [] };
            }
        }

        // Render Contributors
        function renderContributors(contributors) {
            contributorsTableBody.innerHTML = "";
            contributors.forEach((contributor) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${contributor.name}</td>
                    <td>₹${contributor.amount}</td>
                `;
                contributorsTableBody.appendChild(row);
            });
        }

        // Render Expenses
        function renderExpenses(expenses) {
            expensesTableBody.innerHTML = "";
            expenses.forEach((expense) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${expense.name}</td>
                    <td>₹${expense.amount}</td>
                    <td>${expense.paidBy}</td>
                    <td>${expense.comments}</td>
                `;
                expensesTableBody.appendChild(row);
            });
        }

        // Fetch and Render Data
        async function fetchAndRender() {
            try {
                const { contributors, expenses } = await fetchData();
                renderContributors(contributors);
                renderExpenses(expenses);
            } catch (error) {
                console.error("Error rendering data:", error);
            }
        }

        // Initialize
        window.onload = fetchAndRender;
    </script>
</body>
</html>